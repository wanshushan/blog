---
import WidgetLayout from "./WidgetLayout.astro";

interface Props {
	class?: string;
	style?: string;
}

const { class: className, style } = Astro.props;
---

<WidgetLayout name="网站运行时间" id="runtime-stats" class:list={[className]} {style}>
	<div class="grid grid-cols-4 divide-x divide-neutral-200 dark:divide-neutral-700 text-center py-2">
		<div class="px-1">
			<div class="text-lg font-bold text-neutral-900 dark:text-neutral-100" id="runtime-days">-</div>
			<div class="text-xs text-neutral-500 dark:text-neutral-400">天</div>
		</div>
		<div class="px-1">
			<div class="text-lg font-bold text-neutral-900 dark:text-neutral-100" id="runtime-hours">-</div>
			<div class="text-xs text-neutral-500 dark:text-neutral-400">时</div>
		</div>
		<div class="px-1">
			<div class="text-lg font-bold text-neutral-900 dark:text-neutral-100" id="runtime-minutes">-</div>
			<div class="text-xs text-neutral-500 dark:text-neutral-400">分</div>
		</div>
		<div class="px-1">
			<div class="text-lg font-bold text-neutral-900 dark:text-neutral-100" id="runtime-seconds">-</div>
			<div class="text-xs text-neutral-500 dark:text-neutral-400">秒</div>
		</div>
	</div>
	<!-- <div class="text-center text-sm text-neutral-500 dark:text-neutral-400 pb-1">始于 2026-02-22 08:00</div> -->
</WidgetLayout>

<script>
	const SITE_START_TIME = new Date("2026-02-22T08:00:00+08:00").getTime();

	function updateRuntimeStats() {
		const elapsed = Math.max(Date.now() - SITE_START_TIME, 0);
		const totalSeconds = Math.floor(elapsed / 1000);

		const days = Math.floor(totalSeconds / 86400);
		const hours = Math.floor((totalSeconds % 86400) / 3600);
		const minutes = Math.floor((totalSeconds % 3600) / 60);
		const seconds = totalSeconds % 60;

		const daysEl = document.getElementById("runtime-days");
		const hoursEl = document.getElementById("runtime-hours");
		const minutesEl = document.getElementById("runtime-minutes");
		const secondsEl = document.getElementById("runtime-seconds");

		if (daysEl) daysEl.textContent = String(days);
		if (hoursEl) hoursEl.textContent = String(hours);
		if (minutesEl) minutesEl.textContent = String(minutes);
		if (secondsEl) secondsEl.textContent = String(seconds);
	}

	function startRuntimeStats() {
		updateRuntimeStats();
		const currentTimerId = Number(document.body.dataset.runtimeStatsTimer || "0");
		if (currentTimerId) {
			window.clearInterval(currentTimerId);
		}
		const timerId = window.setInterval(updateRuntimeStats, 1000);
		document.body.dataset.runtimeStatsTimer = String(timerId);
	}

	document.addEventListener("DOMContentLoaded", startRuntimeStats);

	if (window.swup) {
		window.swup.hooks.on("page:view", startRuntimeStats);
	}
</script>